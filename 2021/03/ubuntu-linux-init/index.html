<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="description" content="1234567891011121314151617181920212223242526272829303132333435363738..."><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/Yuameshi/Blog-CDN@main/background-pictures/Avatar.png" type="image/x-icon"><script src="/js/material.js" async></script><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><link rel="preload" crossorigin="crossorigin" href="https://cdn.bootcss.com/font-awesome/4.7.0/fonts/fontawesome-webfont.woff2?v=4.7.0" as="font"><link rel="preload" crossorigin="crossorigin" href="https://cdn.jsdelivr.net/npm/mdui@1.0.2/dist/icons/material-icons/MaterialIcons-Regular.woff2" as="font"><link rel="preload" crossorigin="crossorigin" href="https://cdn.jsdelivr.net/npm/mdui@1.0.2/dist/fonts/roboto/Roboto-Regular.woff2" as="font"><link rel="preload" crossorigin="crossorigin" href="https://cdn.jsdelivr.net/npm/mdui@1.0.2/dist/fonts/roboto/Roboto-Medium.woff2" as="font"><link rel="preload" crossorigin="crossorigin" href="https://cdn.jsdelivr.net/npm/mdui@1.0.2/dist/fonts/roboto/Roboto-Bold.woff2" as="font"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdui@1.0.2/dist/css/mdui.min.css?v=1.0.2"><script src="https://cdn.jsdelivr.net/npm/mdui@1.0.2/dist/js/mdui.min.js?v=1.0.2" async></script><title>Ubuntu-Linux服务器初始化(其实就是个备忘录) - Yuameshiの窝</title><meta name="generator" content="Hexo 6.1.0"><link rel="alternate" href="/rss.xml" title="Yuameshiの窝" type="application/rss+xml">
</head><body class="mdui-theme-primary-indigo mdui-theme-accent-pink"><div class="appBar"><div class="mdui-appbar mdui-appbar-fixed" style="width:100vw"><div class="mdui-progress mdui-color-transparent" id="pageLoadProgressIndicator"><div class="mdui-progress-indeterminate"></div></div><div class="mdui-toolbar mdui-color-theme"><button href="javascript:;" class="mdui-btn mdui-btn-icon mdui-ripple" mdui-drawer="{target:'#left-drawer',overlay:true,swipe:true}"><i class="mdui-icon material-icons">&#xe5d2;</i></button> <a href="/" class="mdui-typo-headline">Yuameshiの窝</a><div class="mdui-toolbar-spacer"></div></div></div></div><div class="mdui-drawer mdui-color-white mdui-drawer-full-height mdui-drawer-close" id="left-drawer"><div class="drawerHeader"><div class="drawerAbout mdui-color-theme"><div class="drawerAboutMain mdui-text-color-white" style="--drawer-bg:url(https://cdn.jsdelivr.net/gh/Yuameshi/Blog-CDN@main/background-pictures/87478484_p0.webp)" data-name="Yuameshi" data-slogan="qwq"></div></div></div><nav><div class="mdui-list"><a href="/" class="mdui-list-item mdui-ripple"><i class="mdui-list-item-icon mdui-icon material-icons">&#xe88a; </i>主页 </a><a target="_blank" rel="noopener" href="https://b23.tv/CRByKN" class="mdui-list-item mdui-ripple"><i class="mdui-list-item-icon mdui-icon material-icons">&#xe04b; </i>睿站主页 </a><a href="/friends" class="mdui-list-item mdui-ripple"><i class="mdui-list-item-icon mdui-icon material-icons">&#xe7fb; </i>基友们 </a><a target="_blank" rel="noopener" href="https://github.com/Yuameshi" class="mdui-list-item mdui-ripple"><i class="mdui-list-item-icon mdui-icon material-icons">&#xe869; </i>Gay♂Hub </a><a target="_blank" rel="noopener" href="https://phicommunity.com.cn" class="mdui-list-item mdui-ripple"><i class="mdui-list-item-icon mdui-icon material-icons">&#xe149; </i>PhiCommunity </a><a href="/archives" class="mdui-list-item mdui-ripple"><i class="mdui-list-item-icon mdui-icon material-icons">&#xe149; </i>归档 </a><a href="/about" class="mdui-list-item mdui-ripple"><i class="mdui-list-item-icon mdui-icon material-icons">&#xe88e; </i>关于 </a><a target="_blank" rel="noopener" href="https://status.yuameshi.top/" class="mdui-list-item mdui-ripple"><i class="mdui-list-item-icon mdui-icon material-icons">&#xe24b; </i>憨憨の服务状态</a></div></nav></div><div class="pageTitle mdui-color-theme mdui-color-theme" style="--titleBackgroundUrl:url(https://cdn.jsdelivr.net/gh/Yuameshi/Blog-CDN@main/background-pictures/87489781_p0.webp)"><h1>Ubuntu-Linux服务器初始化(其实就是个备忘录)</h1></div><div class="mainContent mdui-center" id="mainContent"><div class="postPage mdui-card mdui-center"><div class="postMeta mdui-card-media"><div class="mdui-chip postDate" mdui-tooltip="{content: '发布时间'}"><span class="mdui-chip-icon"><i class="mdui-icon material-icons">&#xe192;</i> </span><span class="mdui-chip-title">2021-03-13</span></div><div class="mdui-chip postDate" mdui-tooltip="{content: '更新时间'}"><span class="mdui-chip-icon"><i class="mdui-icon material-icons">&#xe923;</i> </span><span class="mdui-chip-title">2022-04-19</span></div><div class="mdui-chip postCategories" mdui-tooltip="{content: '分类'}"><span class="mdui-chip-icon"><i class="mdui-icon material-icons">&#xe2c7;</i> </span><span class="mdui-chip-title"><a class="category-link" href="/categories/%E4%BC%AA-Server%E8%BF%90%E7%BB%B4/">伪*Server运维</a></span></div></div><div class="mdui-divider"></div><div class="mdui-card-content mdui-typo"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#先开个SWAP</span><br><span class="hljs-built_in">cd</span> /var<br>sudo <span class="hljs-built_in">dd</span> <span class="hljs-keyword">if</span>=/dev/zero of=swapfile bs=1024 count=2000000<br>sudo mkswap swapfile<br>sudo swapon /var/swapfile<br><span class="hljs-built_in">echo</span> /var/swapfile   swap  swap  defaults  0  0 &gt;&gt; /etc/fstab<br><span class="hljs-built_in">cd</span> ~<br><span class="hljs-comment">#更新和安装wget，curl</span><br>sudo apt update<br>sudo apt upgrade<br>sudo apt install curl wget -y<br><span class="hljs-comment">#echo y  sudo apt upgrade (不建议)</span><br><span class="hljs-comment">#配置/安装MySQL8</span><br>wget https://dev.mysql.com/get/mysql-apt-config_0.8.16-1_all.deb<br>dpkg -i mysql-apt-config_0.8.16-1_all.deb<br><span class="hljs-comment">#安装选all</span><br><span class="hljs-comment">#去https://dev.mysql.com/downloads/repo/apt/检查有没有更新</span><br>sudo apt update<br>sudo apt install mysql<br><span class="hljs-comment">#安装lnmp套</span><br>wget http://soft.vpser.net/lnmp/lnmp1.8beta.tar.gz -cO lnmp1.8beta.tar.gz &amp;&amp; tar zxf lnmp1.8beta.tar.gz &amp;&amp; <span class="hljs-built_in">cd</span> lnmp1.8 &amp;&amp; ./install.sh lnmp<br><span class="hljs-comment">#不要安装MySQL</span><br><span class="hljs-comment">#Let&#x27;s Encrypt SSL证书申请-acme.sh客户端</span><br>wget -O -  https://get.acme.sh  sh -s email=你的邮箱地址<br><span class="hljs-comment">#这里我们使用DNS API模式，各DNS解析商的初始化方法参见下方链接</span><br><span class="hljs-comment">#https://github.com/acmesh-official/acme.sh/wiki/dnsapi</span><br><span class="hljs-comment">#这里我是cloudflare，我们要让acme.sh先知道我们的api令牌和各种信息</span><br><span class="hljs-built_in">export</span> CF_Key=<span class="hljs-string">&quot;我的CloudFlare API令牌&quot;</span><br><span class="hljs-built_in">export</span> CF_Email=<span class="hljs-string">&quot;我的CloudFlare账户邮箱&quot;</span><br>~/.acme.sh/acme.sh --issue --dns dns_cf -d 待申请SSL的域名<br><span class="hljs-comment">#申请过后执行 crontab -e 检查是否加了自动续签</span><br><span class="hljs-comment">#正常来说会有类似下面这行东西</span><br><span class="hljs-comment">#33 0 * * * &quot;/root/.acme.sh&quot;/acme.sh --cron --home &quot;/root/.acme.sh&quot; &gt; /dev/null</span><br><span class="hljs-comment">#Let&#x27;s Encrypt SSL证书申请-Certbot客户端(已弃用)</span><br><span class="hljs-comment">#sudo snap install core</span><br><span class="hljs-comment">#sudo snap refresh core</span><br><span class="hljs-comment">#sudo snap install --classic certbot</span><br><span class="hljs-comment">#sudo ln -s /snap/bin/certbot /usr/bin/certbot</span><br><span class="hljs-comment">#./certbot-auto certonly -d *.域名 域名 --manual --preferred-challenges dns --server https://acme-v02.api.letsencrypt.org/directory</span><br><span class="hljs-comment">##执行命令：dig -t txt _acme-challenge.域名查询TXT记录是否生效</span><br><span class="hljs-comment">#配置renew</span><br><span class="hljs-comment">#sudo apt install python3.9</span><br><span class="hljs-comment">#wget https://bootstrap.pypa.io/get-pip.py</span><br><span class="hljs-comment">#pip install certbot-nginx</span><br><span class="hljs-comment">#sudo python3.9 ./get-pip.py</span><br><span class="hljs-comment">#cd /etc/letsencrypt/renewal</span><br><span class="hljs-comment">#ls</span><br><span class="hljs-comment">#vim &#x27;你的域名的配置文件&#x27;</span><br><span class="hljs-comment">#修改</span><br><span class="hljs-comment">#authenticator = nginx                                              #installer = #nginx                                                                   </span><br><span class="hljs-comment">#ln -s /usr/local/nginx/conf/ /etc/nginx</span><br><span class="hljs-comment">#echo 1  certbot --force-renew</span><br><span class="hljs-comment">#定义自动任务</span><br><span class="hljs-comment">#crontab -e</span><br><span class="hljs-comment">#添加：30 2 * * 1 sudo certbot --force-renew</span><br><span class="hljs-comment">#上面的执行时间为：每周一半夜2点30分执行renew任务。</span><br><span class="hljs-comment">#以下为配置Trojan，国内服务器就免了</span><br>sudo bash -c <span class="hljs-string">&quot;<span class="hljs-subst">$(curl -fsSL https://raw.githubusercontent.com/trojan-gfw/trojan-quickstart/master/trojan-quickstart.sh)</span>&quot;</span><br>sudo <span class="hljs-built_in">cp</span> /usr/local/etc/trojan/config.json /usr/local/etc/trojan/config.json.bak<br>sudo vim /usr/local/etc/trojan/config.json<br><span class="hljs-comment">#配置密码，证书等</span><br>sudo systemctl restart trojan<br><span class="hljs-comment">#查看状态：sudo systemctl status trojan</span><br>sudo systemctl <span class="hljs-built_in">enable</span> trojan  <span class="hljs-comment">#开机自启动，</span><br><br><span class="hljs-comment">#开启BBR</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;net.core.default_qdisc=fq&quot;</span> &gt;&gt; /etc/sysctl.conf<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;net.ipv4.tcp_congestion_control=bbr&quot;</span> &gt;&gt; /etc/sysctl.conf<br><span class="hljs-comment">#保存生效</span><br>sysctl -p<br><span class="hljs-comment">#reboot</span><br><span class="hljs-comment">#测试：</span><br>sysctl net.ipv4.tcp_available_congestion_control<br><span class="hljs-comment">#如果结果中有 BBR，则内核开启 BBR 算法成功</span><br>lsmod  grep bbr<br><span class="hljs-comment">#看到 tcp_bbr 则说明 BBR 启动成功</span><br></code></pre></td></tr></table></figure><h2 id="性能测试-大雾-："><a href="#性能测试-大雾-：" class="headerlink" title="性能测试(大雾)："></a>性能测试(大雾)：</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#跑分（UnixBench）</span><br>wget https://s3.amazonaws.com/cloudbench/software/UnixBench5.1.3.tgz<br>tar -xf UnixBench5.1.3.tgz<br><span class="hljs-built_in">cd</span> UnixBench/<br>make all<br>./Run<br><span class="hljs-comment">#Speedtest测速</span><br>wget -qO- bench.sh  bash<br><span class="hljs-comment">#流媒体检测</span><br>bash &lt;(curl -sSL <span class="hljs-string">&quot;https://github.com/CoiaPrant/MediaUnlock_Test/raw/main/check.sh&quot;</span>)<br><span class="hljs-comment">#测回程脚本（二选一）</span><br>wget -q kos.f2k.pub -O kos &amp;&amp; sh kos<br>wget -qO- git.io/besttrace  bash<br><span class="hljs-comment">#三网测速脚本</span><br>bash &lt;(curl -Lso- https://git.io/superspeed)<span class="hljs-comment">#LemonBench</span><br>curl -fsSL https://ilemonrain.com/download/shell/LemonBench.sh  bash -s fast  <span class="hljs-comment">#快速</span><br>curl -fsSL https://ilemonrain.com/download/shell/LemonBench.sh  bash -s full  <span class="hljs-comment">#完整</span><br></code></pre></td></tr></table></figure></div><div class="mdui-divider"></div><div class="pageEnd"><div class="pageEndText mdui-card-actions mdui-typo">本文链接：<a href="https://www.yuameshi.top/2021/03/ubuntu-linux-init/">https://www.yuameshi.top/2021/03/ubuntu-linux-init/</a><br>本文采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/deed" target="_blank" rel="noopener">CC BY-NC-SA 3.0</a> 协议进行许可</div><div class="postTags"><i class="mdui-icon material-icons">&#xe54e;</i> <a class="tag-none-link" href="/tags/BBR/" rel="tag">BBR</a><a class="tag-none-link" href="/tags/LNMP/" rel="tag">LNMP</a><a class="tag-none-link" href="/tags/Let-039-s-Encrypt/" rel="tag">Let&#039;s Encrypt</a><a class="tag-none-link" href="/tags/Linux/" rel="tag">Linux</a><a class="tag-none-link" href="/tags/MySQL/" rel="tag">MySQL</a><a class="tag-none-link" href="/tags/Trojan/" rel="tag">Trojan</a><a class="tag-none-link" href="/tags/Ubuntu/" rel="tag">Ubuntu</a><a class="tag-none-link" href="/tags/%E5%88%9D%E5%A7%8B%E5%8C%96/" rel="tag">初始化</a></div><div class="nav"><a rel="prev" href="/2021/04/rubbish-cn-telecom/"><i class="mdui-icon material-icons">&#xe314;</i> <span>电信是什么垃圾啊</span> </a><a rel="next" href="/2021/03/bbr/"><span>得，原来之前一直没开BBR</span> <i class="mdui-icon material-icons">&#xe315;</i></a></div></div></div></div><footer class="footer"><div class="footerUpperLayer"><div class="title"><a href="https://www.yuameshi.top">Yuameshiの窝</a></div><div class="detail"><div class="text">Hello World! &nbsp;&nbsp;<div class="contact"><a target="_blank" rel="noopener" href="https://github.com/Yuameshi/"><i class="fa fa-github"></i> </a><a href="mailto:yuameshi@outlook.com"><i class="fa fa-envelope"></i> </a><a target="_blank" rel="noopener" href="https://steamcommunity.com/id/2636099143"><i class="fa fa-steam"></i> </a><a target="_blank" rel="noopener" href="https://twitter.com/HanHan_233"><i class="fa fa-twitter"></i> </a><a target="_blank" rel="noopener" href="https://t.me/yuameshi"><i class="fa fa-telegram"></i> </a><a target="_blank" rel="noopener" href="https://t.me/Yuameshi_Words"><i class="fa fa-telegram"></i></a></div></div><div class="copyrights">&copy; 2019 - 2022 Yuameshi</div></div></div><hr><div class="footerLowerLayer"><div class="left"><a href="https://hexo.io" target="_blank">由 Hexo 强力驱动</a> &nbsp;&&nbsp; <a href="https://github.com/Yuameshi/hexo-theme-mdx" target="_blank">由 MDx 主题装饰</a></div><div class="right"><a target="_blank" rel="noopener" href="https://icp.gov.moe/?keyword=20224680">萌ICP备20224680号</a></div></div></footer><button id="goToTopBtn" class="mdui-fab mdui-fab-fixed mdui-fab-hide mdui-ripple mdui-color-theme-accent" style="z-index:100"><i class="mdui-icon material-icons">&#xe316;</i></button></body></html>